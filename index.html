<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>ç¥¨æ®æ¯æ—¥ä»·æ ¼åŒæµ·æŠ¥è‡ªåŠ¨ç”Ÿæˆå™¨</title>

<style>
body{
    font-family:-apple-system,BlinkMacSystemFont,Arial;
    background:#eef2f7;
    margin:0;
    padding:40px;
}
.container{
    max-width:1100px;
    margin:auto;
    background:#fff;
    padding:30px;
    border-radius:12px;
    box-shadow:0 10px 30px rgba(0,0,0,.1);
}
h1{
    margin-top:0;
    color:#1e40af;
}
.controls{
    margin-bottom:30px;
}
.poster-row{
    display:flex;
    gap:30px;
    justify-content:center;
}
.poster-box{
    text-align:center;
}
canvas{
    width:320px;
    border:1px solid #ddd;
    border-radius:8px;
}
button{
    margin-top:12px;
    background:#2563eb;
    color:#fff;
    border:none;
    padding:10px 18px;
    border-radius:6px;
    cursor:pointer;
    font-size:15px;
}
button:hover{
    background:#1d4ed8;
}
</style>
</head>

<body>

<div class="container">
    <h1>ğŸ“Š ç¥¨æ®æ¯æ—¥ä»·æ ¼åŒæµ·æŠ¥è‡ªåŠ¨ç”Ÿæˆå™¨</h1>

    <div class="controls">
        <p>ä¸Šä¼ è¡¨æ ¼å›¾ç‰‡ï¼š</p>
        <input type="file" id="tableImg" accept="image/*">
        <br><br>
        <button onclick="generateAll()">ç”Ÿæˆä¸¤å¼ æµ·æŠ¥</button>
    </div>

    <div class="poster-row">
        <div class="poster-box">
            <canvas id="canvas1" width="1080" height="1920"></canvas><br>
            <button onclick="downloadPoster(1)">ä¸‹è½½æµ·æŠ¥ 1</button>
        </div>

        <div class="poster-box">
            <canvas id="canvas2" width="1080" height="1920"></canvas><br>
            <button onclick="downloadPoster(2)">ä¸‹è½½æµ·æŠ¥ 2</button>
        </div>
    </div>
</div>

<script>
// ================= åŸå§‹é…ç½®ï¼ˆä¸åŠ¨ï¼‰ =================
const POSTER_CONFIGS = [
    {
        bg: "template1.png",
        date: { x: 540, y: 350 },   // â† ä½ åŸæ¥è°ƒå¥½çš„ä½ç½®
        table: { x: 100, y: 440, w: 880, h: 1000 }
    },
    {
        bg: "template2.png",
        date: { x: 540, y: 360 },
        table: { x: 100, y: 450, w: 880, h: 1050 }
    }
];
// ===================================================

function getToday(){
    const d = new Date();
    return `${d.getFullYear()}å¹´${d.getMonth()+1}æœˆ${d.getDate()}æ—¥`;
}

function generateAll(){
    const file = document.getElementById("tableImg").files[0];
    if(!file){
        alert("è¯·å…ˆä¸Šä¼ è¡¨æ ¼å›¾ç‰‡");
        return;
    }

    const reader = new FileReader();
    reader.onload = e => {
        POSTER_CONFIGS.forEach((cfg, i) => {
            drawPoster(
                document.getElementById("canvas" + (i + 1)),
                cfg,
                e.target.result
            );
        });
    };
    reader.readAsDataURL(file);
}

function drawPoster(canvas, cfg, tableBase64){
    const ctx = canvas.getContext("2d");
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    const bg = new Image();
    bg.onload = () => {
        ctx.drawImage(bg, 0, 0, canvas.width, canvas.height);

        // ===== åªè®©æ—¥æœŸå±…ä¸­ï¼ˆä¸æ”¹ä½ç½®ï¼‰=====
        ctx.font = "bold 48px Arial";
        ctx.fillStyle = "#ffffff";
        ctx.textAlign = "center";   // æ ¸å¿ƒ
        ctx.fillText(
            "ç¥¨æ®æ¯æ—¥æŠ¥ä»·ï¼š" + getToday(),
            cfg.date.x,
            cfg.date.y
        );
        ctx.textAlign = "left";     // ç«‹åˆ»æ¢å¤ï¼Œé˜²æ­¢å½±å“å…¶å®ƒå…ƒç´ 

        // ===== è¡¨æ ¼å›¾ç‰‡ =====
        const img = new Image();
        img.onload = () => {
            ctx.drawImage(
                img,
                cfg.table.x,
                cfg.table.y,
                cfg.table.w,
                cfg.table.h
            );
        };
        img.src = tableBase64;
    };
    bg.src = cfg.bg;
}

function downloadPoster(index){
    const canvas = document.getElementById("canvas" + index);
    canvas.toBlob(blob => {
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = `poster_${index}.png`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    });
}
</script>

</body>
</html>
